{% extends "base.html" %}

{% block title %}Public Transport Coverage{% endblock %}

{% block content %}
<main class="bim-coverage">

<h1>Public Transport Coverage</h1>

<section class="skiplinks">
  {% if merge_types -%}
    <p>
      {% for (company, type_to_block_to_vehicles) in company_to_type_to_block_to_vehicles -%}
        {% if !loop.first -%}
          &middot;
        {% endif -%}
        <a class="company" href="#c-{{ company|slugify }}">{{ company|escape }}</a>
      {% endfor -%}
    </p>
  {% else -%}
    {% for (company, type_to_block_to_vehicles) in company_to_type_to_block_to_vehicles -%}
      <p>
        <span class="company">{{ company|escape }}</span>:
        {% for (type, block_to_vehicles) in type_to_block_to_vehicles -%}
          {% if !loop.first -%}
            &middot;
          {% endif -%}
          <a class="type" href="#c-{{ company|slugify }}-t-{{ type|slugify }}">{{ type|escape }}</a>
        {% endfor -%}
      </p>
    {% endfor -%}
  {% endif -%}
</section>

{% for (company, type_to_block_to_vehicles) in company_to_type_to_block_to_vehicles %}
<section class="company" id="c-{{ company|slugify }}">
<h2>{{ company|escape }}</h2>

{% for (type, block_to_vehicles) in type_to_block_to_vehicles %}
<section class="vehicle-type" id="c-{{ company|slugify }}-t-{{ type|slugify }}">
{% if type != "" %}<h3 class="vehicle-type">{{ type|escape }}</h3>{% endif %}

{% for (blk, vehicles) in block_to_vehicles %}
<section class="vehicle-block">

<div class="vehicles-box">

{% if blk.len() > 0 %}
<div class="block-name floaty">{{ blk|escape }}</div>
{% endif %}

{% for vehicle in vehicles -%}
<a href="bim-detail?company={{ company|urlencode|escape }}&amp;vehicle={{ vehicle.full_number_str|urlencode|escape }}"><div
    class="vehicle floaty {% if vehicle.is_active %}active{% else %}inactive{% endif %} {% if vehicle.ride_count > 0 %}ridden{% else %}unridden{% endif %} {% if vehicle.everybody_ride_count > 0 %}other-ridden{% else %}other-unridden{% endif %}" data-full-number="{{ vehicle.full_number_str|escape }}"
    {% if vehicle.has_ride() -%}
      style="background-color:{% if vehicle.is_active %}{{ vehicle.ride_count|mix_color(0, max_ride_count, "#eeffee", "#00ff00") }}{% else %}{{ vehicle.ride_count|mix_color(0, max_ride_count, "#ffffee", "#ffff00") }}{% endif %}"
    {%- else if vehicle.has_everybody_ride() -%}
      style="background-color:{% if vehicle.is_active %}{{ vehicle.everybody_ride_count|mix_color(0, everybody_max_ride_count, "#ccccff", "#6666ff") }}{% else %}{{ vehicle.everybody_ride_count|mix_color(0, everybody_max_ride_count, "#ffeeee", "#ff6666") }}{% endif %}"
    {%- endif %}
    data-ride-count="{{ vehicle.ride_count }}"
>{{ vehicle.number_str|escape }}</div></a>
{%- endfor %}

</div>

</section> {#- end of vehicle block #}
{% endfor %}

</section> {#- end of vehicle type #}
{% endfor %}

</section> {#- end of company #}
{% endfor %}

</main>

{% endblock %}
